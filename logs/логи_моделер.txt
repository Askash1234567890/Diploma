# Создать консоль
# windows -> preferences -> visible

# создание прямоугольника

Opera-3d > SKETCH OBJECT=BLOCK +COMPLETE
Opera-3d > PREVIEW OPTION=START REDISPLAY=NO | BLOCK Name='Block' X0=-20 Y0=-10 Z0=10 X1=20 Y1=10 Z1=60 
Opera-3d > PREVIEW OPTION=END REDISPLAY=NO |  BLOCK Name='Block' X0=-20 Y0=-10 Z0=10 X1=20 Y1=10 Z1=60

# создание фасок

Opera-3d > PICK OPTION=TOGGLE TYPE=EDGE UNIQUEBODYNAME='Block' IDENTIFIER=A.00007
Opera-3d > PICK OPTION=TOGGLE TYPE=EDGE UNIQUEBODYNAME='Block' IDENTIFIER=A.00005
Opera-3d > PREVIEW OPTION=START REDISPLAY=NO | BLEND OPTION=CHAMFER LEFTCHAMFER=5 RIGHTCHAMFER=7 
Opera-3d > PREVIEW OPTION=END REDISPLAY=NO |  BLEND  OPTION=CHAMFER LEFTCHAMFER=5 RIGHTCHAMFER=7 

# выделить объект и сделать свойства материала (pec, data storage level - уровень важности, maximum element size - разбиение на сетку)

Opera-3d > PREVIEW OPTION=PICK | PICK OPTION=ADD PROPERTY=UniqueName LABEL='Block'
Opera-3d > PREVIEW OPTION=ACCEPT REDISPLAY=NO |  CELLDATA OPTION=MODIFY MATERIALLABEL='Pec' POTENTIAL=Total ELEMENTTYPE=Quadratic LEVEL=20 SIZE=3 ELEMSHAPEPREF=NONE

# сохранить проект

# Opera-3d > SAVE OPTION=NEW FILE='C:\Users\Mi\Desktop\opera_proj\quadrupol.opc'

# назначаем свойства материала pec (нелинейные - BH label = deault)

Opera-3d > MATERIALS GUIINIT
Opera-3d > MATERIALS PICK 'Pec'
Opera-3d > MATERIALS OPTION=MODIFY MULINEARITY=NONLINEAR MUANISOTROPY=ISOTROPIC BH='Default' 

# построение области расчета с мелкой сеткой

Opera-3d > SKETCH OBJECT=CYLINDER +COMPLETE
Opera-3d > PREVIEW OPTION=START REDISPLAY=NO | CYLINDER Name='Cylinder' X0=0 Y0=-20 Z0=0 X1=0 Y1=20 Z1=0 -TUBE SHAPECONTROL=SIMPLE MAJORRADIUS=1 MINORRADIUS=1 TOPRADIUS=1 SIDES=2 
Opera-3d > PREVIEW OPTION=END REDISPLAY=NO |  CYLINDER Name='Cylinder' X0=0 Y0=-20 Z0=0 X1=0 Y1=20 Z1=0 -TUBE SHAPECONTROL=SIMPLE MAJORRADIUS=1 MINORRADIUS=1 TOPRADIUS=1 SIDES=2

# изменение свойств расчетной области

Opera-3d > PICK OPTION=TOGGLE PROPERTY=UniqueName LABEL='Cylinder'
Opera-3d > PREVIEW OPTION=PICK | PICK OPTION=ADD PROPERTY=UniqueName LABEL='Cylinder'
Opera-3d > PREVIEW OPTION=ACCEPT REDISPLAY=NO |  CELLDATA OPTION=MODIFY MATERIALLABEL='Air' POTENTIAL=Default ELEMENTTYPE=Linear LEVEL=10 SIZE=0.2 ELEMSHAPEPREF=NONE

# построение апертуры канала и ее свойств

Opera-3d > SKETCH OBJECT=CYLINDER +COMPLETE
Opera-3d > PREVIEW OPTION=START REDISPLAY=NO | CYLINDER Name='Cylinder-001' X0=0 Y0=-20 Z0=0 X1=0 Y1=20 Z1=0 -TUBE SHAPECONTROL=SIMPLE MAJORRADIUS=30 MINORRADIUS=30 TOPRADIUS=30 SIDES=2 
Opera-3d > PREVIEW OPTION=END REDISPLAY=NO |  CYLINDER Name='Cylinder-001' X0=0 Y0=-20 Z0=0 X1=0 Y1=20 Z1=0 -TUBE SHAPECONTROL=SIMPLE MAJORRADIUS=30 MINORRADIUS=30 TOPRADIUS=30 SIDES=2
Opera-3d > PREVIEW OPTION=PICK | PICK OPTION=ADD PROPERTY=UniqueName LABEL='Cylinder-001'
Opera-3d > PREVIEW OPTION=ACCEPT REDISPLAY=NO |  CELLDATA OPTION=MODIFY MATERIALLABEL='Air' POTENTIAL=Default ELEMENTTYPE=Linear LEVEL=5 SIZE=3 ELEMSHAPEPREF=NONE

# задаем соленоид

Opera-3d > RACETRACK OPTION=LOAD
Opera-3d > RACETRACK OPTION=NEW -KEEP XP1=10 YP1=20 WIDTH=5 THICKNESS=40 H1=15 R1=5 INCIRCUIT=NO CIRCUITELEMENT= CURD=10 TOLERANCE=0 DRIVELABEL='Default Drive' THETA2=90 PHI2=0 PSI2=90 XCEN2=0 YCEN2=0 ZCEN2=0 LCNAME='Global coordinate system' RXY=0 RYZ=0 RZX=0 SYMMETRY=1 MODELCOMPONENT=NO

# скругление ребер

Opera-3d > FILTER COMMAND=CURSORHIDE
Opera-3d > SELECT OPTION=CURSORHIDE TYPE=COND N=1
Opera-3d > FILTER COMMAND=PICK
Opera-3d > FILTER TYPE=EDGE
Opera-3d > PICK OPTION=TOGGLE TYPE=EDGE UNIQUEBODYNAME='Block' IDENTIFIER=A.00009
Opera-3d > PICK OPTION=TOGGLE TYPE=EDGE UNIQUEBODYNAME='Block' IDENTIFIER=A.00010
Opera-3d > PICK OPTION=TOGGLE TYPE=EDGE UNIQUEBODYNAME='Block' IDENTIFIER=A.00012
Opera-3d > PICK OPTION=TOGGLE TYPE=EDGE UNIQUEBODYNAME='Block' IDENTIFIER=A.00011
Opera-3d > PREVIEW OPTION=PICK | PICK OPTION=ADD TYPE=EDGE UNIQUEBODYNAME='Block' IDENTIFIER=A.00011
Opera-3d > PREVIEW OPTION=START REDISPLAY=NO | BLEND OPTION=BLEND RADIUS=5 
Opera-3d > PREVIEW OPTION=ACCEPT REDISPLAY=NO |  BLEND  OPTION=BLEND RADIUS=5

# перенести полюс и катушка на 20 по z

Opera-3d > PICK OPTION=TOGGLE PROPERTY=UniqueName LABEL='Block'
Opera-3d > FILTER TYPE=CONDUCTOR
Opera-3d > PICK OPTION=TOGGLE TYPE=COND N=1
Opera-3d > PREVIEW OPTION=PICK | PICK OPTION=ADD TYPE=COND N=1
Opera-3d > PREVIEW OPTION=START REDISPLAY=NO | TRANSFORM OPTION=APPLY TYPE=DISPLACE DU=0 DV=0 DW=20 
Opera-3d > PREVIEW OPTION=ACCEPT REDISPLAY=NO |   TRANSFORM OPTION=APPLY KEEP=NO TYPE=DISPLACE DU=0 DV=0 DW=20

# создаем расчетную область и сразу ее скрываем

Opera-3d > SELECT OPTION=DEFAULT
Opera-3d > SKETCH OBJECT=CYLINDER +COMPLETE
Opera-3d > PREVIEW OPTION=END REDISPLAY=NO |  CYLINDER Name='Cylinder-002' X0=0 Y0=-50 Z0=0 X1=0 Y1=50 Z1=0 -TUBE SHAPECONTROL=SIMPLE MAJORRADIUS=90 MINORRADIUS=90 TOPRADIUS=90 SIDES=2

Opera-3d > FILTER COMMAND=CURSORHIDE
Opera-3d > FILTER TYPE=BODY
Opera-3d > SELECT OPTION=CURSORHIDE PROPERTY=UniqueName LABEL='Cylinder-002'

# Меняем label на background - нужно для рассчетов

Opera-3d > SELECT OPTION=DEFAULT
Opera-3d > PREVIEW OPTION=PICK | PICK OPTION=ADD PROPERTY=UniqueName LABEL='Cylinder-002'
Opera-3d > PREVIEW OPTION=ACCEPT REDISPLAY=NO |  CELLDATA OPTION=MODIFY MATERIALLABEL='Air' POTENTIAL=Default ELEMENTTYPE=Linear LEVEL=1 ELEMSHAPEPREF=NONE
Opera-3d > PREVIEW OPTION=PICK | PICK OPTION=ADD PROPERTY=UniqueName LABEL='Cylinder-002'
Opera-3d > PREVIEW OPTION=ACCEPT REDISPLAY=NO |  RENAME NAME=Background UNIQUENAME=

# поворот магнита и полюса на 45 

Opera-3d > FILTER TYPE=BODY
Opera-3d > PICK OPTION=TOGGLE PROPERTY=UniqueName LABEL='Block'
Opera-3d > FILTER TYPE=CONDUCTOR
Opera-3d > PICK OPTION=TOGGLE TYPE=COND N=1
Opera-3d > PREVIEW OPTION=PICK | PICK OPTION=ADD TYPE=COND N=1
Opera-3d > PREVIEW OPTION=START REDISPLAY=NO | TRANSFORM OPTION=APPLY TYPE=ROTATE ROTU=0 ROTV=1 ROTW=0 ANGLE=45 
Opera-3d > PREVIEW OPTION=ACCEPT REDISPLAY=NO |   TRANSFORM OPTION=APPLY KEEP=NO TYPE=ROTATE ROTU=0 ROTV=1 ROTW=0 ANGLE=45

# задание нелинейных свойств решателя

Opera-3d > ANALYSISDATA OPTION=LOAD PROGRAM=TOSCAMAGN
Opera-3d > ANALYSISDATA OPTION=SET PROGRAM=TOSCAMAGN LINEAR=NO NLITERTYPE=NEWTON NITERATIONS=50 TOLERANCE=1.0E-05 HX=0 HY=0 HZ=0 RHS=ADAPTIVE POTENTIALCUT=YES 

# Создать симметрию и model body

Opera-3d > BACKGROUND OPTION=LOAD
Opera-3d > BACKGROUND OPTION=SET SHAPE=REFLECTIONTRIM   XYSYMMETRYPLANE=YES YZSYMMETRYPLANE=YES ROTZNUM=1 ZXSYMMETRYPLANE=NO EMRXY=NORMMAGN EMRYZ=NORMMAGN
Opera-3d > MODEL CREATE

# Строим поверхностную сетку # ПЕРЕОПРЕДЕЛЕНИЕ ПАРАМЕТРОВ СЕТКИ НА 41:10

Opera-3d > MESH SIZE=10.0 NORMALTOL=30.0 SURFACETOL=0.0 TOLERANCE=1.0E-06 TYPE=PREFERTETRA 

# Создаем объемную сетку

Opera-3d > FILL TOL=1.0E-06 

# Создаем базу данных анализа

SOLVERS SOLVENOW=YES SAVEMODEL=YES, | SOLVERS OPTION=TEST FILE='quadrupol' UNITS=MM ELEMENT=MIXED SURFACE=CURVED, | COMMENT CLEAR=YES TYPE=DBTITLE, | SOLVERS OPTION=OVERWRITE

# Далее переходим в 'логи_пост_процессор'